<div fxLayout fxLayout.xs="column" fxLayoutAlign="center">
  <div fxLayout="column">
    <mat-list>
      <mat-list-item>Markets</mat-list-item>  
      <mat-list-item *ngFor="let mark of markets" routerLink="/trade/{{mark.coin.ticker}}-{{mark.base.ticker}}"  class="mat-elevation-z2 clickable">
        <img matListAvatar src="assets/coins/{{mark.coin.ticker}}.png" alt="{{mark.coin.ticker}}">
        <h3 matLine> {{mark.coin.ticker}}/{{mark.base.ticker}} </h3>
        <p matLine> {{mark.price}} ({{mark.change | percent}}) </p>
      </mat-list-item>
    </mat-list> 
  </div>
  <div fxFlex fxLayout="column" fxLayoutAlign="start stretch" class="center-panel">
    <chart type="StockChart" [options]="options"></chart>
    <div fxLayout.gt-sm="row" fxLayout="column">
      <mat-accordion fxFlex="50" [multi]="true">
        <mat-expansion-panel [expanded]="isSellPanelOpen">
          <mat-expansion-panel-header>
            <mat-panel-title>
              Sell {{market.coin.name}} ({{market.coin.ticker}})
            </mat-panel-title>
            <mat-panel-description>
              {{market.coin.name}} Balance: {{coinBalance}} ({{market.coin.ticker}})
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div>
            <mat-form-field>
              <input matInput type="number" placeholder="Amount" [ngModel]="askAmount" (ngModelChange)="askAmountChanged($event)">
            </mat-form-field>

            <mat-form-field>
              <input matInput type="number" placeholder="Price" [(ngModel)]="askPrice">
            </mat-form-field>

            <button mat-raised-button color="accent" (click)="placeAsk()" [disabled]="validateAskInputs()">Place Order</button>
          </div>
          <div>

            <mat-form-field>
              <input matInput type="number" placeholder="Min" [matTooltip]="minToolTip" [ngModel]="askMin" (ngModelChange)="askMinChanged($event)">
            </mat-form-field>

            <mat-form-field>
              <input matInput type="number" placeholder="Min %" [matTooltip]="minToolTip" [ngModel]="askMinPercent" (ngModelChange)="askMinPercentChanged($event)">
            </mat-form-field>

          </div>

        </mat-expansion-panel>

        <mat-expansion-panel [expanded]="isBidPanelOpen">
          <mat-expansion-panel-header>
            <mat-panel-title fxLayoutAlign="start center">
              Bids&nbsp; 
              <mat-chip-list>
                <mat-chip>{{bids.length}}</mat-chip>
              </mat-chip-list>
            </mat-panel-title>
            <mat-panel-description>
              Total: {{totalBids}} {{market.base}} 
            </mat-panel-description>
          </mat-expansion-panel-header>

          <mat-list>
            <mat-list-item *ngIf="market.bid.array.length == 0">No bids.</mat-list-item>
            <mat-list-item *ngFor="let bid of market.bid.array" fxLayout="row" fxLayoutAlign="space-between center" class="bidbox">
              <div (click)="fillSum(bid)">{{bid.sum | number: '1.8-8'}}</div>
              <div (click)="fillBoth(bid)">{{(bid.amount * bid.price) | number: '1.8-8'}}</div>
              <div (click)="fillAmount(bid.amount)">{{bid.amount | number: '1.8-8'}}</div>
              <div (click)="fillPrice(bid.price)">{{bid.price | number: '1.8-8'}}</div>
            </mat-list-item>
          </mat-list> 
        </mat-expansion-panel>

      </mat-accordion>

      <mat-accordion fxFlex="50" [multi]="true">
        <mat-expansion-panel [expanded]="isBuyPanelOpen">
          <mat-expansion-panel-header>
            <mat-panel-title>
              Buy {{market.coin.name}} ({{market.coin.ticker}}) 
            </mat-panel-title>
            <mat-panel-description>
              {{market.base.name}} Balance: {{baseBalance}} {{market.base.ticker}}
            </mat-panel-description>
          </mat-expansion-panel-header>


          <div>
            <mat-form-field>
              <input matInput type="number" placeholder="Amount" [ngModel]="bidAmount" (ngModelChange)="bidAmountChanged($event)">
            </mat-form-field>

            <mat-form-field>
              <input matInput type="number" placeholder="Price" [(ngModel)]="bidPrice">
            </mat-form-field>

            <button mat-raised-button color="accent" (click)="placeAsk()" [disabled]="validateBidInputs()">Place Order</button>
          </div>
          <div>

            <mat-form-field>
              <input matInput type="number" placeholder="Min" [matTooltip]="minToolTip" [ngModel]="bidMin" (ngModelChange)="bidMinChanged($event)">
            </mat-form-field>

            <mat-form-field>
              <input matInput type="number" placeholder="Min %" [matTooltip]="minToolTip" [ngModel]="bidMinPercent" (ngModelChange)="bidMinPercentChanged($event)">
            </mat-form-field>

          </div>

          <button mat-raised-button color="primary">Place Order</button>
        </mat-expansion-panel>
        <mat-expansion-panel [expanded]="isAskPanelOpen">
          <mat-expansion-panel-header>
            <mat-panel-title fxLayoutAlign="start center">
              Asks&nbsp;
              <mat-chip-list>
                <mat-chip>{{bids.length}}</mat-chip>
              </mat-chip-list>
            </mat-panel-title>
            <mat-panel-description>
              Total: {{totalBids}} {{market.base}} 
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div fxLayout="column">

            <div fxLayout="row" fxLayoutAlign="space-between center" class="bidrow">
              <div fxFlex="25">Price {{market.base.ticker}}</div>
              <div fxFlex="25">Amount {{market.coin.ticker}}</div>
              <div fxFlex="25">Size {{market.base.ticker}}</div>
              <div fxFlex="25">Sum {{market.base.ticker}}</div>
            </div>

            <div *ngIf="market.ask.array.length == 0">No asks.</div>

            <div *ngFor="let bid of market.ask.array" fxLayout="row" fxLayoutAlign="space-between center" class="bidrow">
              <div fxFlex="25" (click)="fillSum(bid)">{{bid.sum | number: '1.8-8'}}</div>
              <div fxFlex="25" (click)="fillTot(bid)">{{(bid.amount * bid.price) | number: '1.8-8'}}</div>
              <div fxFlex="25" (click)="fillAmt(bid)">{{bid.amount | number: '1.8-8'}}</div>
              <div fxFlex="25" (click)="fillPrc(bid)">{{bid.price | number: '1.8-8'}}</div>
            </div>
          </div> 
        </mat-expansion-panel>
      </mat-accordion>
    </div>
    <div>
      <mat-list>
        <mat-list-item>Recent Trades</mat-list-item>  
        <mat-list-item *ngFor="let trade of trades">
        </mat-list-item>
      </mat-list>
    </div>
  </div>
</div>
